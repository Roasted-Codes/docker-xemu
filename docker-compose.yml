---
# ============================================================================
# Roasted-Codes xemu + XLink Kai Docker Compose Configuration
# ============================================================================
# This configuration provides:
#   - xemu emulator with custom config management and automation
#   - XLink Kai for LAN gaming over the internet
#
# Features:
#   - CPU-only rendering (no GPU required)
#   - Automatic config symlinking to /config/emulator/xemu.toml
#   - Optional passleader automation script (auto-runs if present)
#   - XLink Kai for system link gaming over internet
#
# Based on: LinuxServer.io docker-xemu
# See CHANGELOG.md for all modifications
# ============================================================================
services:
  xemu:
    build: .
    image: xemu-custom:latest
    container_name: xemu-halo2-server
    security_opt:
      - seccomp:unconfined
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      # CPU-only rendering settings (no GPU required)
      - DISABLE_ZINK=true
      - DISABLE_DRI3=true
    volumes:
      - ./config:/config
    ports:
      - 3000:3000   # HTTP interface
      - 3001:3001   # HTTPS interface (default, self-signed cert)
      - 9968:9968/udp   # Xemu UDP tunneling (connects to XLink Kai)
    network_mode: host  
    shm_size: "1gb"
    restart: unless-stopped

  xlinkkai:
    image: ich777/xlinkkaievolution
    container_name: xlinkkai
    environment:
      - INTERFACE_NAME=eth0  # Network interface for XLink Kai
      - UMASK=000
      - UID=99
      - GID=100
    volumes:
      - ./config/xlinkkai:/xlinkkaievolution
    ports:
      - 34522:34522  # XLink Kai web interface
      - 34523:34523/udp  # XLink Kai game tunneling (connects to xemu)
    network_mode: host
    privileged: true
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
